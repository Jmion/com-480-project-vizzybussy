<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        #wrapper {
            display: flex;
            justify-content: space-between;
        }

        .movieDiv {

            color: #333;
            display: inline-block;
            font-size: 12px;
            text-align: left;
            overflow: hidden;
            width: 160px;
            position: relative;
            padding-left: 5px;
            padding-right: 5px;
            padding-top: 5px;
        }
    </style>
</head>

<body>
    <script src="https://d3js.org/d3.v2.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <div class="chart">
    </div>

    <script>

        chart("mydata.csv");

        var datearray = [];

        function chart(csvpath) {

            colorrange = ["#B30000", "#E34A33", "#FC8D59", "#FDBB84", "#FDD49E", "#FEF0D9",
                "#045A8D", "#2B8CBE", "#74A9CF", "#A6BDDB", "#D0D1E6", "#F1EEF6",
                "#980043", "#DD1C77", "#DF65B0", "#C994C7", "#D4B9DA", "#F1EEF6"];

            strokecolor = colorrange[0];

            var format = d3.time.format("%Y");

            var margin = { top: 20, right: 40, bottom: 30, left: 30 };
            var width = document.body.clientWidth - margin.left - margin.right;
            var height = 400 - margin.top - margin.bottom;

            var tooltip = d3.select("body")
                .append("div")
                .attr("class", "remove")
                .style("position", "absolute")
                .style("z-index", "20")
                .style("visibility", "hidden")
                .style("top", "30px")
                .style("left", "55px");

            var x = d3.time.scale()
                .range([0, width]);

            var xlin = d3.scale.linear().domain([1966, 2016]).range([0, width])

            var y = d3.scale.linear().domain([0, 1])
                .range([height - 10, 10]);

            var z = d3.scale.ordinal()
                .range(colorrange);

            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom")
                .ticks(d3.time.year);

            var yAxis = d3.svg.axis()
                .scale(y);

            var yAxisr = d3.svg.axis()
                .scale(y);

            var stack = d3.layout.stack()
                .offset("expand")
                .values(function (d) { return d.values; })
                .x(function (d) { return d.fullyear; })
                .y(function (d) { return d.norm_per_year; });

            var nest = d3.nest()
                .key(function (d) { return d.genres; });

            var area = d3.svg.area()
                .interpolate("cardinal")
                .x(function (d) { return x(d.fullyear); })
                //.x0(function(d){ return xlin(d.x0)})
                .y0(function (d) { return y(d.y0); })
                .y1(function (d) { return y(d.y0 + d.norm_per_year); });

            var svg = d3.select(".chart").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var graph = d3.csv(csvpath, function (data) {
                data.forEach(function (d) {
                    // Cast to date and integer
                    d.fullyear = format.parse(d.year);
                    d.total_films = +d.total_films;
                    d.norm_per_year = +d.norm_per_year;
                    d.norm_per_year = Math.round(d.norm_per_year * 1000) / 1000
                    //console.log(d)
                });

                var layers = stack(nest.entries(data));

                x.domain(d3.extent(data, function (d) { return d.fullyear; }));
                y.domain([0, d3.max(data, function (d) { return d.y0 + d.y; })]);
                //x.domain([0, 51]);
                //y.domain([0, 1]);
                console.log(d3.extent(data, function (d) { return d.fullyear; }))
                //console.log(d3.max(data, function(d) { return d.y0 + d.y; }));

                svg.selectAll(".layer")
                    .data(layers)
                    .enter().append("path")
                    .attr("class", "layer")
                    .attr("d", function (d) { return area(d.values); })
                    .style("fill", function (d, i) { return z(i); });


                svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);

                svg.append("g")
                    .attr("class", "y axis")
                    .attr("transform", "translate(" + width + ", 0)")
                    .call(yAxis.orient("right"));

                svg.append("g")
                    .attr("class", "y axis")
                    .call(yAxis.orient("left"));

                svg.selectAll(".layer")
                    .attr("opacity", 1)

                    .on("mousemove", function (d, i) {
                        mousex = d3.mouse(this);
                        mousex = mousex[0];
                        var invertedx = x.invert(mousex);
                        currentYear = invertedx.getFullYear()
                        d3.select(this)
                            .classed("hover", true)
                        tooltip.html("<p>" + d.key + "<br>" + currentYear + "</p>").style("visibility", "visible");
                        changeMovieDisplay(d.key)

                    })
                    .on("mouseout", function (d, i) {
                        svg.selectAll(".layer")
                            .transition()
                            .duration(250)
                            .attr("opacity", "1");
                        d3.select(this)
                            .classed("hover", false)
                            .attr("stroke-width", "0px"), tooltip.html("<p>" + d.key + "<br>" + currentYear + "</p>").style("visibility", "hidden");
                    })
            });

        }

        function changeMovieDisplay(genre) {
            var genreDivId = "movies-" + genre
            var movieDiv = document.getElementById(genreDivId);
            if (movieDiv.style.display == "none") {
                hideAllMovieDivs()
                movieDiv.style.display = "block"
                //console.log(movieDiv)
            }
        };

        function hideAllMovieDivs() {
            var parentDiv = document.getElementById('wrapper');
            var subs = parentDiv.children
            //console.log(subs)
            for (var i = 0; i < subs.length; i++) {
                var a = subs[i];
                //console.log(a)
                a.style.display = 'none';
            }
        }

    </script>
    <script>
        $(document).ready(function () {
            $.getJSON('most_popular_movies.json', function (data) {

                //console.log(data)
                Object.keys(data).forEach(function (k) {
                    var div = document.createElement("div");
                    var genreDivId = "movies-" + k
                    div.id = genreDivId;
                    div.style.display = 'none'; // hide
                    //console.log(div)
                    document.getElementById("wrapper").appendChild(div);
                    //console.log(k);

                    $.each(data[k], function (index, value) {
                        var movieDiv = document.createElement("div");
                        movieDiv.id = genreDivId + "-movie-" + index;
                        movieDiv.className ="movieDiv";
                        //movieDiv.style.display = "inline-block"
                        //movieDiv.style.border = "thick solid #0000FF"

                        movieDiv.innerHTML = value.original_title
                        //div.style.display = 'none'; // hide
                        //console.log(div)
                        document.getElementById(genreDivId).appendChild(movieDiv);
                    });
                });

            });
        });


    </script>

    <div id="wrapper">
    </div>
</body>

</html>